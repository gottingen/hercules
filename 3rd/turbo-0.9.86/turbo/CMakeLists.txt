#
# Copyright 2023 The titan-search Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#


set(TURBO_ALL_SRC
        "base/internal/raw_logging.cc"
        "base/internal/strerror.cc"
        "base/log_severity.cc"
        "base/int128.cc"
        "container/internal/hashtablez_sampler.cc"
        "container/internal/hashtablez_sampler_force_weak_definition.cc"
        "container/internal/raw_hash_set.cc"
        "concurrent/barrier.cc"
        "concurrent/latch.cc"
        "concurrent/notification.cc"
        "concurrent/thread_local.cc"
        "concurrent/spinlock.cc"
        "concurrent/spinlock_wait.cc"
        "concurrent/internal/futex.cc"
        "crypto/crc32c.cc"
        "crypto/md5.cc"
        "crypto/sha1.cc"
        "crypto/sha256.cc"
        "crypto/sha512.cc"
        "crypto/internal/cpu_detect.cc"
        "crypto/internal/crc.cc"
        "crypto/internal/crc_cord_state.cc"
        "crypto/internal/crc_x86_arm_combined.cc"
        "crypto/internal/crc_memcpy_fallback.cc"
        "crypto/internal/crc_memcpy_x86_64.cc"
        "crypto/internal/crc_non_temporal_memcpy.cc"
        "crypto/internal/crc_x86_arm_combined.cc"
        "debugging/failure_signal_handler.cc"
        "debugging/stacktrace.cc"
        "debugging/symbolize.cc"
        "debugging/internal/address_is_readable.cc"
        "debugging/internal/demangle.cc"
        "debugging/internal/elf_mem_image.cc"
        "debugging/internal/examine_stack.cc"
        "debugging/internal/vdso_support.cc"
        "debugging/leak_check.cc"
        "files/file_watcher.cc"
        "files/filesystem.cc"
        "files/file_option.cc"
        "files/file_enumerator.cc"
        "files/sys/random_write_file.cc"
        "files/sys/random_read_file.cc"
        "files/sys/sequential_read_file.cc"
        "files/sys/sequential_write_file.cc"
        "files/sys/temp_file.cc"
        "files/sys/sys_io_posix.cc"
        "files/sys/sys_io_windows.cc"
        "flags/internal/commandlineflag.cc"
        "flags/internal/flag.cc"
        "flags/internal/private_handle_accessor.cc"
        "flags/internal/program_name.cc"
        "flags/internal/usage.cc"
        "flags/commandlineflag.cc"
        "flags/flag.cc"
        "flags/marshalling.cc"
        "flags/parse.cc"
        "flags/usage.cc"
        "flags/reflection.cc"
        "flags/usage_config.cc"
        "flags/app.cc"
        "flags/config.cc"
        "flags/formatter.cc"
        "flags/option.cc"
        "flags/split.cc"
        "flags/string_tools.cc"
        "flags/validators.cc"
        "format/fmt/format.cc"
        "format/fmt/os.cc"
        "hash/bytes/city.cc"
        "hash/bytes/bytes_hash.cc"
        "hash/internal/mixing_hash_state.cc"
        "hash/m3/murmurhash3.cc"
        "hash/m3/m3.cc"
        "hash/xx/xxhash.cc"
        "hash/xx/xxh_x86dispatch.cc"
        "hash/xx/xx.cc"
        "hash/hash_engine.cc"
        "log/async.cc"
        "log/cfg.cc"
        "log/condition.cc"
        "log/color_sinks.cc"
        "log/file_sinks.cc"
        "log/logging.cc"
        "log/tlog.cc"
        "log/stdout_sinks.cc"
        "memory/jemalloc_helper.cc"
        "memory/memory.cc"
        "memory/memory_info.cc"
        "module/module_loader.cc"
        "module/module.cc"
        "platform/internal/cycleclock.cc"
        "base/internal/throw_delegate.cc"
        "platform/internal/unscaledcycleclock.cc"
        "platform/internal/low_level_alloc.cc"
        "random/discrete_distribution.cc"
        "random/gaussian_distribution.cc"
        "random/exponential_biased.cc"
        "random/bytes.cc"
        "random/fwd.cc"
        "random/random.cc"
        "random/unicode.cc"
        "random/internal/pool_urbg.cc"
        "random/internal/randen.cc"
        "random/internal/randen_detect.cc"
        "random/internal/randen_hwaes.cc"
        "random/internal/randen_round_keys.cc"
        "random/internal/randen_slow.cc"
        "random/internal/seed_material.cc"
        "random/seed_gen_exception.cc"
        "random/seed_sequences.cc"
        "status/status_code.cc"
        "status/status.cc"
        "status/error.cc"
        "status/turbo_module.cc"
        "status/result_status.cc"
        "status/status_payload_printer.cc"
        "strings/charconv.cc"
        "strings/cord.cc"
        "strings/cord_analysis.cc"
        "strings/escaping.cc"
        "strings/match.cc"
        "strings/numbers.cc"
        "strings/str_case_conv.cc"
        "strings/str_replace.cc"
        "strings/str_split.cc"
        "strings/str_trim.cc"
        "strings/unicode.cc"
        "strings/internal/charconv_bigint.cc"
        "strings/internal/charconv_parse.cc"
        "strings/internal/cord_internal.cc"
        "strings/internal/cord_rep_btree.cc"
        "strings/internal/cord_rep_btree_navigator.cc"
        "strings/internal/cord_rep_btree_reader.cc"
        "strings/internal/cord_rep_crc.cc"
        "strings/internal/cord_rep_consume.cc"
        "strings/internal/cord_rep_ring.cc"
        "strings/internal/cordz_functions.cc"
        "strings/internal/cordz_handle.cc"
        "strings/internal/cordz_info.cc"
        "strings/internal/cordz_sample_token.cc"
        "strings/internal/escaping.cc"
        "strings/internal/memutil.cc"
        "strings/internal/ostringstream.cc"
        "strings/internal/damerau_levenshtein_distance.cc"
        "system/atexit.cc"
        "system/io/iobuf.cc"
        "system/io/iobuf_printer.cc"
        "system/io/fd_utility.cc"
        "system/io/zero_copy_stream.cc"
        "system/io/sys_io.cc"
        "system/endpoint.cc"
        "system/env.cc"
        "system/threading/thread_name_registry.cc"
        "system/threading.cc"
        "system/sysinfo.cc"
        "system/command.cc"
        "system/internal/sysinfo.cc"
        "system/process.cc"
        "system/process_unix.cc"
        "system/process_win.cc"
        "times/civil_time.cc"
        "times/clock.cc"
        "times/duration.cc"
        "times/format.cc"
        "times/stop_watcher.cc"
        "times/time.cc"
        "times/cctz/civil_time_detail.cc"
        "times/cctz/time_zone_fixed.cc"
        "times/cctz/time_zone_format.cc"
        "times/cctz/time_zone_if.cc"
        "times/cctz/time_zone_impl.cc"
        "times/cctz/time_zone_info.cc"
        "times/cctz/time_zone_libc.cc"
        "times/cctz/time_zone_lookup.cc"
        "times/cctz/time_zone_posix.cc"
        "times/cctz/zone_info_source.cc"
        "unicode/simd_utf.cc"
        "var/internal/periodic_sampler.cc"
        )

if (BUILD_STATIC_LIBRARY)
    carbin_cc_library(
            NAMESPACE
            turbo
            NAME
            turbo
            SOURCES
            ${TURBO_ALL_SRC}
            COPTS
            ${CARBIN_CXX_OPTIONS}
            DEPS
            ${CARBIN_DEPS_LINK} collie::collie
            PUBLIC
    )
endif (BUILD_STATIC_LIBRARY)

if (BUILD_SHARED_LIBRARY)
    carbin_cc_library(
            NAMESPACE
            turbo
            NAME
            turbo
            SOURCES
            ${TURBO_ALL_SRC}
            COPTS
            ${CARBIN_CXX_OPTIONS}
            DEPS
            ${CARBIN_DEPS_LINK}
            SHARED
            PUBLIC
    )
endif (BUILD_SHARED_LIBRARY)

file(GLOB_RECURSE TCLI_SRC "tools/*.cc")
carbin_cc_binary(
        NAME
        turbo
        SOURCES
        ${TCLI_SRC}
        COPTS
        ${CARBIN_CXX_OPTIONS}
        DEPS
        turbo::turbo
        PUBLIC
)